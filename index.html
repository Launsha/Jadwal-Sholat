<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Sholat Indonesia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #121212;
            --secondary-bg: #1e1e1e;
            --card-bg: #2d2d2d;
            --accent-color: #00b4d8;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --transition-speed: 0.4s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background-color var(--transition-speed) ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.6s ease forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--card-bg);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent-color);
        }

        header p {
            color: var(--text-secondary);
        }

        .city-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .city-button {
            background-color: var(--secondary-bg);
            color: var(--text-secondary);
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .city-button:hover {
            background-color: var(--card-bg);
            color: var(--text-primary);
        }

        .city-button.active {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            font-weight: bold;
        }

        .prayer-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transform: translateY(0);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .date-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .greg-date {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .hijri-date {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .prayer-times {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .prayer-item {
            background-color: var(--secondary-bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: transform var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }

        .prayer-item:hover {
            transform: scale(1.05);
            background-color: rgba(0, 180, 216, 0.1);
        }

        .prayer-item.active {
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }

        .prayer-name {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .prayer-time {
            font-size: 1.5rem;
        }

        .countdown {
            margin-top: 5px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .active .countdown {
            color: var(--primary-bg);
        }

        .location-info {
            text-align: center;
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .location-info i {
            color: var(--accent-color);
            margin-right: 5px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 300px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 50px;
            border-top: 1px solid var(--card-bg);
            color: var(--text-secondary);
        }

        .source-info {
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .error-message {
            text-align: center;
            color: #ff6b6b;
            padding: 20px;
            background-color: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .page-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-bg);
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }

        .cities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .prayer-times {
                grid-template-columns: repeat(2, 1fr);
            }

            .date-info {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .prayer-times {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-transition" id="pageTransition"></div>
    <div class="container">
        <header>
            <h1>Jadwal Sholat Indonesia</h1>
            <p>Dapatkan jadwal sholat terkini dan akurat</p>
        </header>

        <div class="city-selector" id="citySelector">
            <!-- Cities will be populated here -->
        </div>

        <div id="contentArea">
            <div class="loading">
                <div class="spinner"></div>
                <p>Memuat jadwal sholat...</p>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 Jadwal Sholat Indonesia</p>
            <div class="source-info">
                Sumber data: API Muslim Salat - Sumber terpercaya untuk jadwal sholat di Indonesia
            </div>
        </div>
    </div>

    <script>
        // Cities data
        const cities = [
            { id: "1301", name: "Jakarta", coordinates: { lat: -6.2088, long: 106.8456 } },
            { id: "1214", name: "Bandung", coordinates: { lat: -6.9175, long: 107.6191 } },
            { id: "1204", name: "Tangerang", coordinates: { lat: -6.1781, long: 106.6300 } },
            { id: "1213", name: "Bekasi", coordinates: { lat: -6.2349, long: 106.9896 } },
            { id: "1503", name: "Surabaya", coordinates: { lat: -7.2492, long: 112.7508 } },
            { id: "1504", name: "Semarang", coordinates: { lat: -6.9932, long: 110.4203 } },
            { id: "1302", name: "Yogyakarta", coordinates: { lat: -7.7956, long: 110.3695 } },
            { id: "1403", name: "Medan", coordinates: { lat: 3.5896, long: 98.6731 } },
            { id: "1404", name: "Makassar", coordinates: { lat: -5.1477, long: 119.4327 } },
            { id: "1501", name: "Palembang", coordinates: { lat: -2.9761, long: 104.7754 } },
            { id: "1502", name: "Balikpapan", coordinates: { lat: -1.2379, long: 116.8529 } },
            { id: "1505", name: "Denpasar", coordinates: { lat: -8.6705, long: 115.2126 } }
        ];

        // Set default city (Jakarta)
        let selectedCity = cities[0];
        let savedCity = localStorage.getItem('selectedCity');
        if (savedCity) {
            try {
                const parsedCity = JSON.parse(savedCity);
                if (parsedCity && parsedCity.id) {
                    selectedCity = parsedCity;
                }
            } catch (e) {
                console.error("Error parsing saved city", e);
            }
        }

        // Prayer times data and current prayer info
        let prayerData = null;
        let currentPrayer = null;
        let nextPrayer = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
        });

        function initializePage() {
            renderCitySelector();
            loadPrayerTimes(selectedCity);
            
            // Update every minute
            setInterval(() => {
                updateCountdowns();
            }, 60000);
        }

        function renderCitySelector() {
            const citySelector = document.getElementById('citySelector');
            citySelector.innerHTML = '';

            // Add popular cities as buttons
            const popularCities = cities.slice(0, 6);
            popularCities.forEach(city => {
                const button = document.createElement('button');
                button.className = `city-button ${city.id === selectedCity.id ? 'active' : ''}`;
                button.textContent = city.name;
                button.addEventListener('click', () => selectCity(city));
                citySelector.appendChild(button);
            });

            // Add "More Cities" button
            const moreButton = document.createElement('button');
            moreButton.className = 'city-button';
            moreButton.innerHTML = '<i class="fas fa-ellipsis-h"></i> Kota Lain';
            moreButton.addEventListener('click', showAllCities);
            citySelector.appendChild(moreButton);
        }

        function showAllCities() {
            const contentArea = document.getElementById('contentArea');
            
            // Start page transition
            const pageTransition = document.getElementById('pageTransition');
            pageTransition.style.opacity = '1';
            
            setTimeout(() => {
                // Create cities grid
                let html = '<div class="prayer-card">';
                html += '<h2 style="margin-bottom: 20px;">Pilih Kota</h2>';
                html += '<div class="cities-grid">';
                
                cities.forEach(city => {
                    html += `<button class="city-button ${city.id === selectedCity.id ? 'active' : ''}" 
                                    onclick="selectCity(${JSON.stringify(city).replace(/"/g, '&quot;')})">
                                ${city.name}
                            </button>`;
                });
                
                html += '</div></div>';
                
                contentArea.innerHTML = html;
                
                // End page transition
                pageTransition.style.opacity = '0';
            }, 400);
        }

        function selectCity(city) {
            selectedCity = city;
            localStorage.setItem('selectedCity', JSON.stringify(city));
            
            // Update UI
            renderCitySelector();
            loadPrayerTimes(city);
        }

        function loadPrayerTimes(city) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat jadwal sholat untuk ${city.name}...</p>
                </div>
            `;

            // Start page transition
            const pageTransition = document.getElementById('pageTransition');
            pageTransition.style.opacity = '1';

            // Construct the date in YYYY-MM-DD format
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;

            // Use a reliable prayer times API
            // We'll use the Muslim Salat API by fetching 1 month of data
            // API documentation: https://aladhan.com/prayer-times-api
            const apiUrl = `https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=${city.coordinates.lat}&longitude=${city.coordinates.long}&method=11`;
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    try {
                        // Find today's data
                        const monthData = data.data;
                        const todayData = monthData.find(item => item.date.gregorian.date === `${day}-${month}-${year}`);
                        
                        if (!todayData) {
                            throw new Error("Tidak dapat menemukan data untuk hari ini");
                        }

                        prayerData = {
                            gregorianDate: todayData.date.gregorian,
                            hijriDate: todayData.date.hijri,
                            timings: {
                                Fajr: formatTime(todayData.timings.Fajr),
                                Sunrise: formatTime(todayData.timings.Sunrise),
                                Dhuhr: formatTime(todayData.timings.Dhuhr),
                                Asr: formatTime(todayData.timings.Asr),
                                Maghrib: formatTime(todayData.timings.Maghrib),
                                Isha: formatTime(todayData.timings.Isha)
                            }
                        };

                        renderPrayerTimes();
                    } catch (error) {
                        console.error("Error processing data:", error);
                        showError("Terjadi kesalahan saat memproses data jadwal sholat.");
                    }
                })
                .catch(error => {
                    console.error("Error fetching prayer times:", error);
                    showError("Tidak dapat memuat jadwal sholat. Silakan coba lagi nanti.");
                })
                .finally(() => {
                    // End page transition
                    setTimeout(() => {
                        pageTransition.style.opacity = '0';
                    }, 200);
                });
        }

        function formatTime(timeString) {
            // Convert "HH:MM (GMT+7)" to "HH:MM"
            return timeString.split(" ")[0];
        }

        function renderPrayerTimes() {
            if (!prayerData) return;

            // Find current and next prayers
            determineCurrentPrayer();

            const contentArea = document.getElementById('contentArea');
            
            // Format the Gregorian date
            const gregDate = new Date(
                prayerData.gregorianDate.year, 
                parseInt(prayerData.gregorianDate.month.number) - 1,
                prayerData.gregorianDate.day
            );
            const formattedGregDate = gregDate.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });

            // Format the Hijri date
            const hijriDate = `${prayerData.hijriDate.day} ${prayerData.hijriDate.month.id} ${prayerData.hijriDate.year} H`;

            let html = `
                <div class="prayer-card">
                    <div class="date-info">
                        <div class="greg-date">${formattedGregDate}</div>
                        <div class="hijri-date">${hijriDate}</div>
                    </div>
                    <div class="prayer-times">
            `;

            // Add prayer times
            const prayers = [
                { id: 'Fajr', name: 'Subuh' },
                { id: 'Sunrise', name: 'Terbit' },
                { id: 'Dhuhr', name: 'Dzuhur' },
                { id: 'Asr', name: 'Ashar' },
                { id: 'Maghrib', name: 'Maghrib' },
                { id: 'Isha', name: 'Isya' }
            ];

            prayers.forEach(prayer => {
                const isActive = currentPrayer === prayer.id;
                const countdown = getCountdown(prayer.id);
                
                html += `
                    <div class="prayer-item ${isActive ? 'active' : ''}">
                        <div class="prayer-name">${prayer.name}</div>
                        <div class="prayer-time">${prayerData.timings[prayer.id]}</div>
                        <div class="countdown">${countdown}</div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
                <div class="location-info">
                    <i class="fas fa-map-marker-alt"></i> ${selectedCity.name}, Indonesia
                </div>
            `;

            contentArea.innerHTML = html;
        }

        function determineCurrentPrayer() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const prayers = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            const prayerTimes = {};
            
            // Convert prayer times to minutes since midnight
            prayers.forEach(prayer => {
                const [hours, minutes] = prayerData.timings[prayer].split(':').map(Number);
                prayerTimes[prayer] = hours * 60 + minutes;
            });
            
            // Determine current and next prayer
            currentPrayer = null;
            nextPrayer = null;
            
            // Check if it's before Fajr or after Isha
            if (currentTime < prayerTimes.Fajr) {
                nextPrayer = 'Fajr';
            } else if (currentTime >= prayerTimes.Isha) {
                currentPrayer = 'Isha';
                nextPrayer = 'Fajr'; // Next day's Fajr
            } else {
                // Find the current prayer time
                for (let i = 0; i < prayers.length - 1; i++) {
                    if (currentTime >= prayerTimes[prayers[i]] && currentTime < prayerTimes[prayers[i + 1]]) {
                        currentPrayer = prayers[i];
                        nextPrayer = prayers[i + 1];
                        break;
                    }
                }
            }
        }

        function getCountdown(prayerId) {
            if (!prayerData || !nextPrayer) return '';
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const [hours, minutes] = prayerData.timings[prayerId].split(':').map(Number);
            const prayerTime = hours * 60 + minutes;
            
            if (prayerId === currentPrayer) {
                return 'Waktu Saat Ini';
            } else if (prayerId === nextPrayer) {
                let diff = prayerTime - currentTime;
                if (diff < 0) {
                    // Next day's Fajr
                    diff += 24 * 60;
                }
                
                const diffHours = Math.floor(diff / 60);
                const diffMinutes = diff % 60;
                
                return `${diffHours}j ${diffMinutes}m lagi`;
            }
            
            return '';
        }

        function updateCountdowns() {
            determineCurrentPrayer();
            renderPrayerTimes();
        }

        function showError(message) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>${message}</p>
                    <button class="city-button" style="margin-top: 15px;" onclick="loadPrayerTimes(selectedCity)">
                        Coba Lagi
                    </button>
                </div>
            `;
        }

        // Global function for city selection from the "all cities" view
        window.selectCity = function(city) {
            selectedCity = city;
            localStorage.setItem('selectedCity', JSON.stringify(city));
            
            // Start page transition
            const pageTransition = document.getElementById('pageTransition');
            pageTransition.style.opacity = '1';
            
            setTimeout(() => {
                // Update UI
                renderCitySelector();
                loadPrayerTimes(city);
            }, 400);
        };
    </script>
</body>
</html>